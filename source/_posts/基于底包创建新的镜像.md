---
title : 基于底包创建新的镜像
date: 2021-03-30 11:42:12
categories: 工具
tags :
        - docker
        - opencv
---

# 基于底包创建新的镜像

> 由于项目依赖了OpenCV对图像进行处理，而且项目都是采用Docker部署的。目前公司提供的镜像仓库都没有可用的包，所以只能自己修改。

## 下载底包

```bash
docker image pull xxx/xxx/xxxx/xxx:latest
```

## 启动终端

先查看镜像是否下载成功：

```bash
docker image ls
```

```bash
docker run mirrors.tencent.com/tlinux/tlinux2.4-public:latest /bin/bash
```

## 安装OpenCV

### 安装依赖

```
sudo yum install -y cmake gcc
```

### 下载

```bash
wget https://github.com/opencv/opencv/archive/4.5.1.zip
```

### 解压

```
unzip  4.5.1.zip
```

### 解压安装包

```
cd opencv-4.5.1
```

### 创建build目录

```
mkdir build
```

### 进入 build 目录

```
cd build
```

### 设置 make 参数

```
cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/local ..
```

### 开始构建

```
make
# 注：此步需要等待较长时间
```

### 开始安装

```
make install
```

## 导出包

```
docker export -o xxxx-opencv.tar CONTAINERID
```

## 导入包

```
docker import xxxx-opencv.tar xxxx/xxx/xxx-opencv
```

这样我们就大功告成啦，只需要将倒入的image上传到自己的镜像仓库就完成了。
